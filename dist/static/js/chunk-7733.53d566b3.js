(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7733"],{DNGl:function(t,e,n){"use strict";n.r(e);var s={data:function(){return{ws:null,count:0,userId:this.$store.getters.id,username:this.$store.getters.name,avatar:this.$store.getters.avatar,list:[],contentText:""}},mounted:function(){this.initWebSocket()},destroyed:function(){this.ws.onclose(void 0)},methods:{sendText:function(){var t=this;if(t.$refs.sendMsg.focus(),t.contentText){var e={userId:t.userId,username:t.username,avatar:t.avatar,msg:t.contentText,count:t.count};t.ws.send(JSON.stringify(e)),t.contentText="",setTimeout(function(){t.scrollBottm()},500)}},initWebSocket:function(){var t=this;if(window.WebSocket){var e="ws://"+window.location.hostname+":8080/groupChat/110/"+this.userId,n=new WebSocket(e);t.ws=n,n.onopen=function(t){console.log("服务器连接成功: "+e)},n.onclose=function(t){console.log("服务器连接关闭: "+e)},n.onerror=function(){console.log("服务器连接出错: "+e)},n.onmessage=function(e){var n=JSON.parse(e.data);t.count=n.count,t.list=[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(t.list),[{userId:n.userId,username:n.username,avatar:n.avatar,content:n.msg}])}}},scrollBottm:function(){var t=this.$refs["msg-box"];t.scrollTop=t.scrollHeight}}},o=(n("DNci"),n("KHd+")),r=Object(o.a)(s,function(){var t,e=this,n=e.$createElement,s=e._self._c||n;return s("div",{staticClass:"chat-box"},[s("header",[e._v(e._s(e.$t("chat_room"))+" (在线:"+e._s(e.count)+"人)")]),e._v(" "),s("div",{ref:"msg-box",staticClass:"msg-box"},e._l(e.list,function(t,n){return s("div",{key:n,staticClass:"msg",style:t.userId==e.userId?"flex-direction:row-reverse":""},[s("div",{staticClass:"user-head"},[s("img",{attrs:{src:t.avatar,height:"30",width:"30",title:t.username}})]),e._v(" "),s("div",{staticClass:"user-msg"},[s("span",{class:t.userId==e.userId?"right":"left",style:t.userId==e.userId?" float: right;":""},[e._v(e._s(t.content))])])])})),e._v(" "),s("div",{staticClass:"input-box"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.contentText,expression:"contentText"}],ref:"sendMsg",attrs:{type:"text"},domProps:{value:e.contentText},on:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.sendText()},input:function(t){t.target.composing||(e.contentText=t.target.value)}}}),e._v(" "),s("div",{staticClass:"btn",class:(t={},t["btn-active"]=e.contentText,t),on:{click:function(t){e.sendText()}}},[e._v("发送")])])])},[],!1,null,"0d3c28b3",null);r.options.__file="chat.vue";e.default=r.exports},DNci:function(t,e,n){"use strict";var s=n("ZGG0");n.n(s).a},ZGG0:function(t,e,n){}}]);